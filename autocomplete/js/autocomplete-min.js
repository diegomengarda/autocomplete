!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={url:"",width:"auto",minChars:2,listMaxHeight:200,params:{},dataType:"json",zIndex:9999,type:"POST",timeout:1e4,cache:!1,debug:!1,onSelectItem:function(){}};e.fn.autocomplete=function(i){var n=this.length;if(0==n)return this;if(n>1)return this.each(function(){e(this).autocomplete(i)}),this;var s={};s.el=this;var a,o=200;s.keys={ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40};var l=function(){s.settings=e.extend({},t,i),s.offsetLeft=s.el.offset().left,s.offsetBottom=s.el.outerHeight(),s.height=s.el.outerHeight(),s.width=("auto"==s.settings.width?s.el.outerWidth()+s.height:s.settings.outerWidth)-10,s.classref="class_"+Math.random().toString(36).slice(-8),s.indexSelected=-1,c()},c=function(){s.el.attr("autocomplete","off"),s.el.addClass(s.classref),s.el.wrap('<div class="fn_autocomplete '+s.classref+'" />'),s.el.css("padding-right",s.height),s.bloco=e("div."+s.classref),s.bloco.width(s.width),s.bloco.append('<div class="indicator"><span class="icon icon-search"></span></div><ul></ul>'),s.indicator=s.bloco.find(".indicator"),s.indicator.css({width:s.height+"px",height:s.height+"px"}),s.lista=s.bloco.find("ul"),s.countItens=-1,s.lista.css({maxHeight:s.settings.listMaxHeight,top:s.offsetBottom,zIndex:s.settings.zIndex}),r()},r=function(){s.el.on("keyup",function(t){var i=e(this);clearTimeout(a),a=setTimeout(function(){p(i,t)},o)}),s.el.on("keypress",function(e){g(e)}),s.el.on("keydown",function(e){m(e)}),s.lista.on("click","li",function(){y(e(this).index())})},d=function(){s.offsetBottom=s.height,s.lista.css({top:s.offsetBottom})},u=function(){s.lista.find("li").removeClass("active"),s.lista.html("").hide(),s.indexSelected=-1},f=function(){s.indicator.find("span").removeClass("icon-search").addClass("icon-spinner animated")},h=function(){s.indicator.find("span").removeClass("animated icon-spinner").addClass("icon-search")},p=function(e,t){var i=t.keyCode||t.which,n=parseInt(s.indexSelected);switch(i){case s.keys.ESC:u();break;case s.keys.TAB:return void(n>=0&&y(n));case s.keys.RETURN:return void(n>=0&&y(n));case s.keys.UP:n-1>=0&&k(n-1);break;case s.keys.DOWN:n+1>=0&&n+1<s.countItens&&k(n+1);break;default:return void(e.val().length>=s.settings.minChars?v():u())}t.stopImmediatePropagation(),t.preventDefault()},g=function(e){var t=e.keyCode||e.which;t==s.keys.RETURN&&e.preventDefault()},m=function(e){var t=e.keyCode||e.which,i=parseInt(s.indexSelected);t==s.keys.TAB&&i>=0&&y(i)},v=function(){s.request&&(s.request.abort(),u()),f(),s.settings.params.q=s.el.val(),s.request=e.ajax({type:s.settings.type,cache:s.settings.cache,url:s.settings.url,data:s.settings.params,dataType:s.settings.dataType,timeout:s.settings.timeout}).done(function(e){s.request.abort(),"null"!=JSON.stringify(e)&&"[]"!=JSON.stringify(e)&&""!=JSON.stringify(e)&&(x(e),s.lista.show()),h()}).fail(function(e){h(),s.settings.debug&&console.log("Erro: "+e.responseText)})},y=function(e){var t=s.lista.find("li:eq("+e+")");return s.el.val(t.data("value")),u(),s.settings.onSelectItem(s.el,t.data("parameters"))},k=function(e){s.lista.find("li").removeClass("active"),s.lista.find("li:eq("+e+")").addClass("active"),s.indexSelected=e},x=function(t){u(),d(),e.each(t,function(e,t){var i=t.value,n=JSON.stringify(t.parameters),a=i.toUpperCase(),o=s.el.val().toUpperCase();s.lista.append(-1!=a.indexOf(o)?"<li data-value='"+i+"' data-parameters='"+n+"'>"+a.replace(o,"<u><strong>"+o+"</strong></u>")+"</li>":"<li data-value='"+i+"' data-parameters='"+n+"'>"+a.replace(/(<([^>]+)>)/gi,"")+"</li>")}),s.lista.show(),s.countItens=s.lista.find("li").length,k(0)};return e("html:not(.fn_autocomplete)").click(function(){e(".fn_autocomplete ul").is(":visible")&&(e(".fn_autocomplete ul").hide(),u())}),l(),this}});