!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var e={url:"",width:"auto",minChars:2,maxHeight:200,params:{},dataType:"json",zIndex:9999,type:"POST",timeout:1e4,cache:!1,intervalTimer:300,onSelectItem:function(){}};t.fn.autocomplete=function(i){var n=this.length;if(0==n)return this;if(n>1)return this.each(function(){t(this).autocomplete(i)}),this;var s={};s.el=this,s.identTimer,s.keys={ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40};var a=function(){s.settings=t.extend({},e,i),s.offsetLeft=s.el.offset().left,s.offsetBottom=s.el.outerHeight(),s.height=s.el.outerHeight(),s.width="auto"==s.settings.width?s.el.outerWidth()+s.height:s.settings.width,s.classref="class_"+Math.random().toString(36).slice(-8),s.indexSelected=-1,o()},o=function(){console.log(s.width),s.el.attr("autocomplete","off"),s.el.addClass(s.classref),s.el.wrap('<div class="fn_autocomplete '+s.classref+'" />'),s.el.css("padding-right",s.height),s.bloco=t("div."+s.classref),s.bloco.width(s.width),s.bloco.append('<div class="fn_indicator"><span class="fn_icon fn_icon_search"></span></div><ul></ul>'),s.indicator=s.bloco.find(".fn_indicator"),s.indicator.css({width:s.height+"px",height:s.height+"px"}),s.lista=s.bloco.find("ul"),s.countItens=-1,s.lista.css({width:s.width,maxHeight:s.settings.maxHeight,top:s.offsetBottom,zIndex:s.settings.zIndex}),c()},c=function(){s.el.on("keyup",function(e){u(t(this),e)}),s.el.on("keypress",function(t){h(t)}),s.el.on("keydown",function(t){m(t)}),s.lista.on("click","li",function(){g(t(this).index())})},l=function(){s.offsetBottom=s.height,s.lista.css({top:s.offsetBottom})},r=function(){s.lista.find("li").removeClass("active"),s.lista.html("").hide(),s.indexSelected=-1},d=function(){s.indicator.find("span").removeClass("fn_icon_search").addClass("fn_icon_spinner fn_animated")},f=function(){s.indicator.find("span").removeClass("fn_icon_spinner fn_animated").addClass("fn_icon_search")},u=function(t,e){var i=e.keyCode||e.which,n=parseInt(s.indexSelected);switch(i){case s.keys.ESC:r();break;case s.keys.TAB:return void(n>=0&&g(n));case s.keys.RETURN:return void(n>=0&&g(n));case s.keys.UP:n-1>=0&&v(n-1);break;case s.keys.DOWN:n+1>=0&&n+1<s.countItens&&v(n+1);break;default:return void(t.val().length>=s.settings.minChars?(clearTimeout(s.identTimer),s.identTimer=setTimeout(p,s.settings.intervalTimer)):r())}e.stopImmediatePropagation(),e.preventDefault()},h=function(t){var e=t.keyCode||t.which;e==s.keys.RETURN&&t.preventDefault()},m=function(t){var e=t.keyCode||t.which,i=parseInt(s.indexSelected);e==s.keys.TAB&&i>=0&&g(i)},p=function(){s.request&&s.request.abort(),d(),s.settings.params.q=s.el.val(),s.request=t.ajax({type:s.settings.type,cache:s.settings.cache,url:s.settings.url,data:s.settings.params,dataType:s.settings.dataType,timeout:s.settings.timeout}).done(function(t){s.request.abort(),"null"!=JSON.stringify(t)&&"[]"!=JSON.stringify(t)&&""!=JSON.stringify(t)&&(y(t),s.lista.show()),f()}).fail(function(t,e){f(),console.log("Erro: "+e)})},g=function(t){var e=s.lista.find("li:eq("+t+")");return s.el.val(e.text()),r(),s.settings.onSelectItem(s.el,e.data("data"))},v=function(t){s.lista.find("li").removeClass("active"),s.lista.find("li:eq("+t+")").addClass("active"),s.indexSelected=t},y=function(e){r(),l(),t.each(e,function(t,e){var i=e.item,n=JSON.stringify(e.dados);s.lista.append("<li data-data='"+n+"'>"+i+"</li>")}),s.lista.show(),s.countItens=s.lista.find("li").length,v(0)};return t("html:not(.fn_autocomplete)").click(function(){t(".fn_autocomplete ul").is(":visible")&&(t(".fn_autocomplete ul").hide(),r())}),a(),this}});